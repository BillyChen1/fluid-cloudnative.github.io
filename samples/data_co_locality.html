<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DEMO - Cache Co-locality for Workload Scheduling | Fluid</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/fluid-stacked-color.svg">
    <meta name="description" content="Fluid, elastic data abstraction and acceleration for BigData/AI applications in cloud.">
    
    <link rel="preload" href="/assets/css/0.styles.edbab21a.css" as="style"><link rel="preload" href="/assets/js/app.ff89ebb7.js" as="script"><link rel="preload" href="/assets/js/2.9883a141.js" as="script"><link rel="preload" href="/assets/js/38.901c3a3c.js" as="script"><link rel="prefetch" href="/assets/js/10.ff2f4ab4.js"><link rel="prefetch" href="/assets/js/11.7511cb62.js"><link rel="prefetch" href="/assets/js/12.6cc0075a.js"><link rel="prefetch" href="/assets/js/13.ac2fd551.js"><link rel="prefetch" href="/assets/js/14.6c27fec2.js"><link rel="prefetch" href="/assets/js/15.5b399203.js"><link rel="prefetch" href="/assets/js/16.56d4c631.js"><link rel="prefetch" href="/assets/js/17.ded4c0e4.js"><link rel="prefetch" href="/assets/js/18.63823924.js"><link rel="prefetch" href="/assets/js/19.403ee62d.js"><link rel="prefetch" href="/assets/js/20.0b8ab171.js"><link rel="prefetch" href="/assets/js/21.4b4f535c.js"><link rel="prefetch" href="/assets/js/22.aca0862a.js"><link rel="prefetch" href="/assets/js/23.1ef5c1d2.js"><link rel="prefetch" href="/assets/js/24.793d122b.js"><link rel="prefetch" href="/assets/js/25.5a478a64.js"><link rel="prefetch" href="/assets/js/26.128776a2.js"><link rel="prefetch" href="/assets/js/27.f4afbc76.js"><link rel="prefetch" href="/assets/js/28.cb0e85f7.js"><link rel="prefetch" href="/assets/js/29.2849f366.js"><link rel="prefetch" href="/assets/js/3.2ada5a00.js"><link rel="prefetch" href="/assets/js/30.4c8dfe96.js"><link rel="prefetch" href="/assets/js/31.70054216.js"><link rel="prefetch" href="/assets/js/32.392b4ec1.js"><link rel="prefetch" href="/assets/js/33.3b370eba.js"><link rel="prefetch" href="/assets/js/34.41a7b5eb.js"><link rel="prefetch" href="/assets/js/35.95f0a00d.js"><link rel="prefetch" href="/assets/js/36.168f5f83.js"><link rel="prefetch" href="/assets/js/37.4452566b.js"><link rel="prefetch" href="/assets/js/39.ec1506de.js"><link rel="prefetch" href="/assets/js/4.c98b7bc1.js"><link rel="prefetch" href="/assets/js/40.04ca41b7.js"><link rel="prefetch" href="/assets/js/41.3e25d182.js"><link rel="prefetch" href="/assets/js/42.1727ac1f.js"><link rel="prefetch" href="/assets/js/43.bce70a95.js"><link rel="prefetch" href="/assets/js/44.7ac691a6.js"><link rel="prefetch" href="/assets/js/45.be2e439b.js"><link rel="prefetch" href="/assets/js/46.05713c89.js"><link rel="prefetch" href="/assets/js/47.8ea80a90.js"><link rel="prefetch" href="/assets/js/48.1583acd2.js"><link rel="prefetch" href="/assets/js/49.aa1e9b68.js"><link rel="prefetch" href="/assets/js/5.f5746beb.js"><link rel="prefetch" href="/assets/js/50.21c7a3f8.js"><link rel="prefetch" href="/assets/js/51.4aa0466d.js"><link rel="prefetch" href="/assets/js/52.7a76af04.js"><link rel="prefetch" href="/assets/js/53.d536675e.js"><link rel="prefetch" href="/assets/js/54.de903366.js"><link rel="prefetch" href="/assets/js/55.9253880d.js"><link rel="prefetch" href="/assets/js/56.182caf99.js"><link rel="prefetch" href="/assets/js/57.e637b6a7.js"><link rel="prefetch" href="/assets/js/58.f13666f3.js"><link rel="prefetch" href="/assets/js/59.2f3414d9.js"><link rel="prefetch" href="/assets/js/6.8b6ef391.js"><link rel="prefetch" href="/assets/js/60.2e782ed8.js"><link rel="prefetch" href="/assets/js/61.912178b8.js"><link rel="prefetch" href="/assets/js/62.fe49a10b.js"><link rel="prefetch" href="/assets/js/63.e955b402.js"><link rel="prefetch" href="/assets/js/64.5a01d069.js"><link rel="prefetch" href="/assets/js/65.c387d4a2.js"><link rel="prefetch" href="/assets/js/66.d6fc89ad.js"><link rel="prefetch" href="/assets/js/67.ecece501.js"><link rel="prefetch" href="/assets/js/68.0de414a9.js"><link rel="prefetch" href="/assets/js/69.c3b6d603.js"><link rel="prefetch" href="/assets/js/7.480203b2.js"><link rel="prefetch" href="/assets/js/70.c3c1666d.js"><link rel="prefetch" href="/assets/js/71.74b515d0.js"><link rel="prefetch" href="/assets/js/72.565535fb.js"><link rel="prefetch" href="/assets/js/73.aa4b80fa.js"><link rel="prefetch" href="/assets/js/74.5babfb55.js"><link rel="prefetch" href="/assets/js/75.c240aa07.js"><link rel="prefetch" href="/assets/js/76.bdf11e70.js"><link rel="prefetch" href="/assets/js/77.da79c69e.js"><link rel="prefetch" href="/assets/js/78.b025a170.js"><link rel="prefetch" href="/assets/js/79.a0ef641e.js"><link rel="prefetch" href="/assets/js/8.ceafe7a8.js"><link rel="prefetch" href="/assets/js/80.9488d79d.js"><link rel="prefetch" href="/assets/js/81.bda0a9bb.js"><link rel="prefetch" href="/assets/js/82.8c563a57.js"><link rel="prefetch" href="/assets/js/83.9e589297.js"><link rel="prefetch" href="/assets/js/84.5c46079d.js"><link rel="prefetch" href="/assets/js/85.469b5e0f.js"><link rel="prefetch" href="/assets/js/86.1cfc9826.js"><link rel="prefetch" href="/assets/js/87.33adc5b0.js"><link rel="prefetch" href="/assets/js/88.adc406fa.js"><link rel="prefetch" href="/assets/js/89.8f120c05.js"><link rel="prefetch" href="/assets/js/9.c4bb6552.js"><link rel="prefetch" href="/assets/js/90.3728026e.js"><link rel="prefetch" href="/assets/js/91.a0fcfd1f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.edbab21a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/fluid-horizontal-color.png" alt="Fluid" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docs" class="dropdown-title"><span class="title">Docs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Docs" class="mobile-dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link">
  Dev
</a></li><li class="dropdown-item"><!----> <a href="/samples/" class="nav-link router-link-active">
  Samples
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/community/community.html" class="nav-link">
  Community
</a></li><li class="dropdown-item"><!----> <a href="/community/ADOPTERS.html" class="nav-link">
  Adopters
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/technology/" class="nav-link">
  Technology
</a></li><li class="dropdown-item"><!----> <a href="/blog/releases/" class="nav-link">
  Releases
</a></li><li class="dropdown-item"><!----> <a href="/blog/casestudy/" class="nav-link">
  Case Study
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/samples/data_co_locality.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/samples/data_co_locality.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docs" class="dropdown-title"><span class="title">Docs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Docs" class="mobile-dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link">
  Dev
</a></li><li class="dropdown-item"><!----> <a href="/samples/" class="nav-link router-link-active">
  Samples
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/community/community.html" class="nav-link">
  Community
</a></li><li class="dropdown-item"><!----> <a href="/community/ADOPTERS.html" class="nav-link">
  Adopters
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/technology/" class="nav-link">
  Technology
</a></li><li class="dropdown-item"><!----> <a href="/blog/releases/" class="nav-link">
  Releases
</a></li><li class="dropdown-item"><!----> <a href="/blog/casestudy/" class="nav-link">
  Case Study
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/samples/data_co_locality.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/samples/data_co_locality.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/samples/" aria-current="page" class="sidebar-link">DEMO - Speed Up Accessing Remote Files</a></li><li><a href="/samples/accelerate_pvc.html" class="sidebar-link">DEMO - Accelerate PVC with Fluid</a></li><li><a href="/samples/machinelearning.html" class="sidebar-link">DEMO - Accelerate Machine Learning Training with Fluid</a></li><li><a href="/samples/data_warmup.html" class="sidebar-link">Demo - Data Preloading</a></li><li><a href="/samples/accelerate_hdfs.html" class="sidebar-link">DEMO - Speed Up Accessing HDFS Client Files</a></li><li><a href="/samples/accelerate_s3_minio.html" class="sidebar-link">DEMO - Speed Up Accessing Minio Files</a></li><li><a href="/samples/data_co_locality.html" aria-current="page" class="active sidebar-link">DEMO - Cache Co-locality for Workload Scheduling</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/samples/data_co_locality.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/samples/data_co_locality.html#set-up-workspace" class="sidebar-link">Set Up Workspace</a></li><li class="sidebar-sub-header"><a href="/samples/data_co_locality.html#install-resources-to-kubernetes" class="sidebar-link">Install Resources to Kubernetes</a></li><li class="sidebar-sub-header"><a href="/samples/data_co_locality.html#clean-up" class="sidebar-link">Clean Up</a></li></ul></li><li><a href="/samples/multi_dataset_same_node_accessing.html" class="sidebar-link">DEMO - Single-Machine Multiple-Dataset Speed Up Accessing Remote Files</a></li><li><a href="/samples/nonroot_access.html" class="sidebar-link">Example - Using Fluid to access non-root user's data</a></li><li><a href="/samples/tieredstore_config.html" class="sidebar-link">Demo - Alluxio Tieredstore Configuration</a></li><li><a href="/samples/use_encryptoptions.html" class="sidebar-link">DEMO - Use Secret to configure Dataset sensitive information</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="demo-cache-co-locality-for-workload-scheduling"><a href="#demo-cache-co-locality-for-workload-scheduling" class="header-anchor">#</a> DEMO - Cache Co-locality for Workload Scheduling</h1> <p>In Fluid, remote files specified in <code>Dataset</code> object are schedulable, which means you are able to control where to put your data in a k8s cluster,
just like what you may have done to Pods. Also, Fluid is able to make cache co-locality scheduling decisions for workloads to minimize overhead costs.</p> <p>This demo will show you an overview about features mentioned above.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>Before everything we are going to do, please refer to <a href="/userguide/install.html">Installation Guide</a> to install Fluid on your Kubernetes Cluster, and make sure all the components used by Fluid are ready like this:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pod -n fluid-system
NAME                                  READY   STATUS    RESTARTS   AGE
alluxioruntime-controller-5b64fdbbb-84pc6   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8h
csi-nodeplugin-fluid-fwgjh                  <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8h
csi-nodeplugin-fluid-ll8bq                  <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8h
dataset-controller-5b7848dbbb-n44dj         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8h
</code></pre></div><p>Normally, you shall see a Pod named &quot;dataset-controller&quot;, a Pod named &quot;alluxioruntime-controller&quot; and several Pods named &quot;csi-nodeplugin&quot;.
The num of &quot;csi-nodeplugin&quot; Pods depends on how many nodes your Kubernetes cluster have(e.g. 2 in this demo), so please make sure all &quot;csi-nodeplugin&quot; Pods are working properly.</p> <h2 id="set-up-workspace"><a href="#set-up-workspace" class="header-anchor">#</a> Set Up Workspace</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">mkdir</span> <span class="token operator">&lt;</span>any-path<span class="token operator">&gt;</span>/co-locality
$ <span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>any-path<span class="token operator">&gt;</span>/co-locality
</code></pre></div><h2 id="install-resources-to-kubernetes"><a href="#install-resources-to-kubernetes" class="header-anchor">#</a> Install Resources to Kubernetes</h2> <p><strong>Check all nodes in your Kubernetes cluster</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get nodes
NAME                       STATUS   ROLES    AGE     VERSION
cn-beijing.192.168.1.146   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   7d14h   v1.16.9-aliyun.1
cn-beijing.192.168.1.147   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   7d14h   v1.16.9-aliyun.1
</code></pre></div><p><strong>Label one of the nodes</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl label nodes cn-beijing.192.168.1.146 hbase-cache<span class="token operator">=</span>true
</code></pre></div><p>Since we'll use <code>NodeSelector</code> to manage where to put our data, we mark the desired node by labeling it.</p> <p><strong>Check all nodes again</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get node -L hbase-cache
NAME                       STATUS   ROLES    AGE     VERSION            HBASE-CACHE
cn-beijing.192.168.1.146   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   7d14h   v1.16.9-aliyun.1   <span class="token boolean">true</span>
cn-beijing.192.168.1.147   Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   7d14h   v1.16.9-aliyun.1   
</code></pre></div><p>Only one of the two nodes holds a label <code>hbase-cache=true</code>. In the following steps, we are going to make sure it's the only location the data cache can be put on.</p> <p><strong>Check the <code>Dataset</code> object to be created</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ cat<span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>dataset.yaml</span>
apiVersion: data.fluid.io/v1alpha1
kind: Dataset
metadata:
  name: hbase
spec:
  mounts:
    - mountPoint: https://downloads.apache.org/hbase/stable/
      name: hbase
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: hbase-cache
              operator: In
              values:
                - &quot;true&quot;
EOF</span>
</code></pre></div><p>We defined a <code>nodeSelectorTerm</code> in <code>Dataset</code> object's <code>spec</code> to make sure only nodes with label <code>hbase-cache=true</code> are considered to be available for the dataset.</p> <p><strong>Create the dataset object</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl create -f dataset.yaml
dataset.data.fluid.io/hbase created
</code></pre></div><p><strong>Check the <code>AlluxioRuntime</code> object to be created</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ cat<span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>runtime.yaml</span>
apiVersion: data.fluid.io/v1alpha1
kind: AlluxioRuntime
metadata:
  name: hbase
spec:
  replicas: 2
  tieredstore:
    levels:
      - mediumtype: MEM
        path: /dev/shm
        quota: 2Gi
        high: &quot;0.95&quot;
        low: &quot;0.7&quot;
EOF</span>
</code></pre></div><p>In this snippet of yaml, there are many specifications used by Fluid to launch an Alluxio instance. The <code>spec.replicas</code> in the yaml above is set to 2, which means an Alluxio instance with 1 master and 2 workers is expected to be launched.</p> <p><strong>Create the <code>AlluxioRuntime</code> object</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl create -f runtime.yaml
alluxioruntime.data.fluid.io/hbase created

$ kubectl get pod -o wide
NAME                 READY   STATUS    RESTARTS   AGE    IP              NODE                       NOMINATED NODE   READINESS GATES
hbase-fuse-42csf     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          104s   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-master-0       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          3m3s   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-worker-l62m4   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          104s   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>While two running workers are expected, there's only one running on the node with label <code>hbase-cache=true</code>. The <code>nodeSelectorTerm</code> stops another worker from being deployed.</p> <p><strong>Check status of the <code>AlluxioRuntime</code> object</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get alluxioruntime hbase -o wide
NAME    READY MASTERS   DESIRED MASTERS   MASTER PHASE   READY WORKERS   DESIRED WORKERS   WORKER PHASE   READY FUSES   DESIRED FUSES   FUSE PHASE     AGE
hbase   <span class="token number">1</span>               <span class="token number">1</span>                 Ready          <span class="token number">1</span>               <span class="token number">2</span>                 PartialReady   <span class="token number">1</span>             <span class="token number">2</span>               PartialReady   4m3s
</code></pre></div><p>As expected, <code>Worker Phase</code> is <code>PartialReady</code> and <code>Ready Workers: 1</code> is less than <code>Desired Workers: 2</code>.</p> <p><strong>Check the workload to be created</strong></p> <p>A sample workload is provided to demonstrate how cache co-locality scheduling works. Let's check it out first:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ cat<span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>app.yaml</span>
apiVersion: apps/v1beta1
kind: StatefulSet
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  replicas: 2
  serviceName: &quot;nginx&quot;
  podManagementPolicy: &quot;Parallel&quot;
  selector: # define how the deployment finds the pods it manages
    matchLabels:
      app: nginx
  template: # define the pods specifications
    metadata:
      labels:
        app: nginx
    spec:
      affinity:
        # prevent two Nginx Pod from being scheduled at the same Node
        # just for demonstrating co-locality demo
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - nginx
            topologyKey: &quot;kubernetes.io/hostname&quot;
      containers:
        - name: nginx
          image: nginx
          volumeMounts:
            - mountPath: /data
              name: hbase-vol
      volumes:
        - name: hbase-vol
          persistentVolumeClaim:
            claimName: hbase
EOF</span>
</code></pre></div><p>The <code>podAntiAffinity</code> property might be a little confusing.
Here is the explanation: The <code>podAntiAffinity</code> property makes sure all pods created by the workload should be distributed across different nodes, which can provide us a clear view of how cache co-locality scheduling works.
In short, it's just a property for demonstration, you don't need to put much focus on that 😃</p> <p><strong>Run the workload</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl create -f app.yaml
statefulset.apps/nginx created
</code></pre></div><p><strong>Check status of the workload</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pod -o wide -l <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx
NAME      READY   STATUS    RESTARTS   AGE    IP              NODE                       NOMINATED NODE   READINESS GATES
nginx-0   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m5s   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx-1   <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          2m5s   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>Only one Pod is ready, and running on the only node that matches the <code>nodeSelectorTerm</code></p> <p><strong>Check the reason why it's still not ready</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl describe pod nginx-1
<span class="token punctuation">..</span>.
Events:
  Type     Reason            Age        From               Message
  ----     ------            ----       ----               -------
  Warning  FailedScheduling  <span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span>  default-scheduler  <span class="token number">0</span>/2 nodes are available: <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> didn<span class="token string">'t match pod affinity/anti-affinity, 1 node(s) didn'</span>t satisfy existing pods anti-affinity rules, <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> had volume node affinity conflict.
  Warning  FailedScheduling  <span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span>  default-scheduler  <span class="token number">0</span>/2 nodes are available: <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> didn<span class="token string">'t match pod affinity/anti-affinity, 1 node(s) didn'</span>t satisfy existing pods anti-affinity rules, <span class="token number">1</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> had volume node affinity conflict.
</code></pre></div><p>As you may have seen, for one reason, <code>podAntiAffinity</code> prevents <code>nginx-1</code> Pod from being scheduled together with <code>nginx-0</code>. For another, there's only one node satisfying the given affinity condition.</p> <p><strong>Label another node</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl label node cn-beijing.192.168.1.147 hbase-cache<span class="token operator">=</span>true
</code></pre></div><p>Now all of the two nodes hold the same label <code>hbase-cache=true</code>, re-check all the pods:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pod -o wide
NAME                 READY   STATUS    RESTARTS   AGE   IP              NODE                       NOMINATED NODE   READINESS GATES
hbase-fuse-42csf     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          44m   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-fuse-kth4g     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10m   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-master-0       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          46m   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-worker-l62m4   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          44m   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
hbase-worker-rvncl   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          10m   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>There're two running Alluxio workers now.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get alluxioruntime hbase -o wide
NAME    READY MASTERS   DESIRED MASTERS   MASTER PHASE   READY WORKERS   DESIRED WORKERS   WORKER PHASE   READY FUSES   DESIRED FUSES   FUSE PHASE   AGE
hbase   <span class="token number">1</span>               <span class="token number">1</span>                 Ready          <span class="token number">2</span>               <span class="token number">2</span>                 Ready          <span class="token number">2</span>             <span class="token number">2</span>               Ready        46m43s
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl get pod -l <span class="token assign-left variable">app</span><span class="token operator">=</span>nginx -o wide
NAME      READY   STATUS    RESTARTS   AGE   IP              NODE                       NOMINATED NODE   READINESS GATES
nginx-0   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          21m   <span class="token number">192.168</span>.1.146   cn-beijing.192.168.1.146   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
nginx-1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          21m   <span class="token number">192.168</span>.1.147   cn-beijing.192.168.1.147   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>Another nginx Pod is also no longer pending.</p> <p>In conclusion, schedulable data cache and cache co-locality scheduling for workloads are both supported by Fluid. Usually, they work together and offer a more flexible way to users who need some data management in Kubernetes.</p> <h2 id="clean-up"><a href="#clean-up" class="header-anchor">#</a> Clean Up</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>$ kubectl delete -f <span class="token builtin class-name">.</span>

<span class="token comment"># unlabel nodes</span>
$ kubectl label node cn-beijing.192.168.1.146 hbase-cache-
$ kubectl label node cn-beijing.192.168.1.147 hbase-cache-
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/samples/accelerate_s3_minio.html" class="prev">
        DEMO - Speed Up Accessing Minio Files
      </a></span> <span class="next"><a href="/samples/multi_dataset_same_node_accessing.html">
        DEMO - Single-Machine Multiple-Dataset Speed Up Accessing Remote Files
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ff89ebb7.js" defer></script><script src="/assets/js/2.9883a141.js" defer></script><script src="/assets/js/38.901c3a3c.js" defer></script>
  </body>
</html>
