<!DOCTYPE html>
<html lang="zh-ch">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM性能分析工具使用 | Fluid</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/fluid-stacked-color.svg">
    <meta name="description" content="Fluid, 在云上为大数据以及AI应用的弹性数据提供抽象和加速服务。">
    
    <link rel="preload" href="/assets/css/0.styles.edbab21a.css" as="style"><link rel="preload" href="/assets/js/app.ff89ebb7.js" as="script"><link rel="preload" href="/assets/js/2.9883a141.js" as="script"><link rel="preload" href="/assets/js/61.912178b8.js" as="script"><link rel="prefetch" href="/assets/js/10.ff2f4ab4.js"><link rel="prefetch" href="/assets/js/11.7511cb62.js"><link rel="prefetch" href="/assets/js/12.6cc0075a.js"><link rel="prefetch" href="/assets/js/13.ac2fd551.js"><link rel="prefetch" href="/assets/js/14.6c27fec2.js"><link rel="prefetch" href="/assets/js/15.5b399203.js"><link rel="prefetch" href="/assets/js/16.56d4c631.js"><link rel="prefetch" href="/assets/js/17.ded4c0e4.js"><link rel="prefetch" href="/assets/js/18.63823924.js"><link rel="prefetch" href="/assets/js/19.403ee62d.js"><link rel="prefetch" href="/assets/js/20.0b8ab171.js"><link rel="prefetch" href="/assets/js/21.4b4f535c.js"><link rel="prefetch" href="/assets/js/22.aca0862a.js"><link rel="prefetch" href="/assets/js/23.1ef5c1d2.js"><link rel="prefetch" href="/assets/js/24.793d122b.js"><link rel="prefetch" href="/assets/js/25.5a478a64.js"><link rel="prefetch" href="/assets/js/26.128776a2.js"><link rel="prefetch" href="/assets/js/27.f4afbc76.js"><link rel="prefetch" href="/assets/js/28.cb0e85f7.js"><link rel="prefetch" href="/assets/js/29.2849f366.js"><link rel="prefetch" href="/assets/js/3.2ada5a00.js"><link rel="prefetch" href="/assets/js/30.4c8dfe96.js"><link rel="prefetch" href="/assets/js/31.70054216.js"><link rel="prefetch" href="/assets/js/32.392b4ec1.js"><link rel="prefetch" href="/assets/js/33.3b370eba.js"><link rel="prefetch" href="/assets/js/34.41a7b5eb.js"><link rel="prefetch" href="/assets/js/35.95f0a00d.js"><link rel="prefetch" href="/assets/js/36.168f5f83.js"><link rel="prefetch" href="/assets/js/37.4452566b.js"><link rel="prefetch" href="/assets/js/38.901c3a3c.js"><link rel="prefetch" href="/assets/js/39.ec1506de.js"><link rel="prefetch" href="/assets/js/4.c98b7bc1.js"><link rel="prefetch" href="/assets/js/40.04ca41b7.js"><link rel="prefetch" href="/assets/js/41.3e25d182.js"><link rel="prefetch" href="/assets/js/42.1727ac1f.js"><link rel="prefetch" href="/assets/js/43.bce70a95.js"><link rel="prefetch" href="/assets/js/44.7ac691a6.js"><link rel="prefetch" href="/assets/js/45.be2e439b.js"><link rel="prefetch" href="/assets/js/46.05713c89.js"><link rel="prefetch" href="/assets/js/47.8ea80a90.js"><link rel="prefetch" href="/assets/js/48.1583acd2.js"><link rel="prefetch" href="/assets/js/49.aa1e9b68.js"><link rel="prefetch" href="/assets/js/5.f5746beb.js"><link rel="prefetch" href="/assets/js/50.21c7a3f8.js"><link rel="prefetch" href="/assets/js/51.4aa0466d.js"><link rel="prefetch" href="/assets/js/52.7a76af04.js"><link rel="prefetch" href="/assets/js/53.d536675e.js"><link rel="prefetch" href="/assets/js/54.de903366.js"><link rel="prefetch" href="/assets/js/55.9253880d.js"><link rel="prefetch" href="/assets/js/56.182caf99.js"><link rel="prefetch" href="/assets/js/57.e637b6a7.js"><link rel="prefetch" href="/assets/js/58.f13666f3.js"><link rel="prefetch" href="/assets/js/59.2f3414d9.js"><link rel="prefetch" href="/assets/js/6.8b6ef391.js"><link rel="prefetch" href="/assets/js/60.2e782ed8.js"><link rel="prefetch" href="/assets/js/62.fe49a10b.js"><link rel="prefetch" href="/assets/js/63.e955b402.js"><link rel="prefetch" href="/assets/js/64.5a01d069.js"><link rel="prefetch" href="/assets/js/65.c387d4a2.js"><link rel="prefetch" href="/assets/js/66.d6fc89ad.js"><link rel="prefetch" href="/assets/js/67.ecece501.js"><link rel="prefetch" href="/assets/js/68.0de414a9.js"><link rel="prefetch" href="/assets/js/69.c3b6d603.js"><link rel="prefetch" href="/assets/js/7.480203b2.js"><link rel="prefetch" href="/assets/js/70.c3c1666d.js"><link rel="prefetch" href="/assets/js/71.74b515d0.js"><link rel="prefetch" href="/assets/js/72.565535fb.js"><link rel="prefetch" href="/assets/js/73.aa4b80fa.js"><link rel="prefetch" href="/assets/js/74.5babfb55.js"><link rel="prefetch" href="/assets/js/75.c240aa07.js"><link rel="prefetch" href="/assets/js/76.bdf11e70.js"><link rel="prefetch" href="/assets/js/77.da79c69e.js"><link rel="prefetch" href="/assets/js/78.b025a170.js"><link rel="prefetch" href="/assets/js/79.a0ef641e.js"><link rel="prefetch" href="/assets/js/8.ceafe7a8.js"><link rel="prefetch" href="/assets/js/80.9488d79d.js"><link rel="prefetch" href="/assets/js/81.bda0a9bb.js"><link rel="prefetch" href="/assets/js/82.8c563a57.js"><link rel="prefetch" href="/assets/js/83.9e589297.js"><link rel="prefetch" href="/assets/js/84.5c46079d.js"><link rel="prefetch" href="/assets/js/85.469b5e0f.js"><link rel="prefetch" href="/assets/js/86.1cfc9826.js"><link rel="prefetch" href="/assets/js/87.33adc5b0.js"><link rel="prefetch" href="/assets/js/88.adc406fa.js"><link rel="prefetch" href="/assets/js/89.8f120c05.js"><link rel="prefetch" href="/assets/js/9.c4bb6552.js"><link rel="prefetch" href="/assets/js/90.3728026e.js"><link rel="prefetch" href="/assets/js/91.a0fcfd1f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.edbab21a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/fluid-horizontal-color.png" alt="Fluid" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/guide/" class="nav-link">
  指南
</a></li><li class="dropdown-item"><!----> <a href="/zh/dev/" class="nav-link router-link-active">
  开发
</a></li><li class="dropdown-item"><!----> <a href="/zh/samples/" class="nav-link">
  示例
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="社区" class="dropdown-title"><span class="title">社区</span> <span class="arrow down"></span></button> <button type="button" aria-label="社区" class="mobile-dropdown-title"><span class="title">社区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/community/community.html" class="nav-link">
  社区
</a></li><li class="dropdown-item"><!----> <a href="/zh/community/ADOPTERS.html" class="nav-link">
  合作伙伴
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/blog/technology/" class="nav-link">
  技术内幕
</a></li><li class="dropdown-item"><!----> <a href="/zh/blog/releases/" class="nav-link">
  版本发布
</a></li><li class="dropdown-item"><!----> <a href="/zh/blog/casestudy/" class="nav-link">
  案例学习
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/profiling.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/dev/profiling.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/guide/" class="nav-link">
  指南
</a></li><li class="dropdown-item"><!----> <a href="/zh/dev/" class="nav-link router-link-active">
  开发
</a></li><li class="dropdown-item"><!----> <a href="/zh/samples/" class="nav-link">
  示例
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="社区" class="dropdown-title"><span class="title">社区</span> <span class="arrow down"></span></button> <button type="button" aria-label="社区" class="mobile-dropdown-title"><span class="title">社区</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/community/community.html" class="nav-link">
  社区
</a></li><li class="dropdown-item"><!----> <a href="/zh/community/ADOPTERS.html" class="nav-link">
  合作伙伴
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/blog/technology/" class="nav-link">
  技术内幕
</a></li><li class="dropdown-item"><!----> <a href="/zh/blog/releases/" class="nav-link">
  版本发布
</a></li><li class="dropdown-item"><!----> <a href="/zh/blog/casestudy/" class="nav-link">
  案例学习
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev/profiling.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/dev/profiling.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/zh/dev/" aria-current="page" class="sidebar-link">Fluid开发文档</a></li><li><a href="/zh/dev/api_doc.html" class="sidebar-link">API Reference</a></li><li><a href="/zh/dev/runtime_dev_guide.html" class="sidebar-link">Dataset和Runtime的生命周期</a></li><li><a href="/zh/dev/profiling.html" aria-current="page" class="active sidebar-link">JVM性能分析工具使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/dev/profiling.html#下载并解压" class="sidebar-link">下载并解压</a></li><li class="sidebar-sub-header"><a href="/zh/dev/profiling.html#简单使用" class="sidebar-link">简单使用</a></li></ul></li><li><a href="/zh/dev/multiple-client-support.html" class="sidebar-link">如何使用其他语言（非Go语言）客户端</a></li><li><a href="/zh/dev/use_go_create_resource.html" class="sidebar-link">如何使用Go客户端创建、删除fluid资源</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jvm性能分析工具使用"><a href="#jvm性能分析工具使用" class="header-anchor">#</a> JVM性能分析工具使用</h1> <p>有时需要对Fluid的底层缓存引擎，如Alluxio，进行性能分析，以更加迅速地找到性能瓶颈。
<a href="https://github.com/jvm-profiling-tools/async-profiler" target="_blank" rel="noopener noreferrer">async-profiler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一款非常全面的JVM profiling工具，支持对<code>cpu</code>，<code>lock</code>等多种事件采样。
在本文档中，我们介绍<code>async-profiler</code>的简单使用方法。
请参考<a href="https://github.com/jvm-profiling-tools/async-profiler" target="_blank" rel="noopener noreferrer">async-profiler官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>获取更加详细的使用教程。</p> <h2 id="下载并解压"><a href="#下载并解压" class="header-anchor">#</a> 下载并解压</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">wget</span> https://github.com/jvm-profiling-tools/async-profiler/releases/download/v1.7.1/async-profiler-1.7.1-linux-x64.tar.gz
$ <span class="token function">tar</span> -zxf async-profiler-1.7.1-linux-x64.tar.gz
</code></pre></div><h2 id="简单使用"><a href="#简单使用" class="header-anchor">#</a> 简单使用</h2> <ol><li><p>查看Java进程</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ jps
<span class="token number">8576</span> AlluxioFuse
<span class="token number">33916</span> Jps
</code></pre></div></li> <li><p>采样占用CPU时间</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./profiler.sh -e cpu -i 1ms -d <span class="token number">300</span> -f cpu.txt <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span>
</code></pre></div><p><strong>命令说明</strong>:</p> <ul><li><code>-e &lt;EVENT&gt;</code>： 指定要采样的时间，支持<code>cpu</code>, <code>lock</code>等</li> <li><code>-i &lt;INTERVAL&gt;</code>： 指定采样间隔， 支持最小纳秒级别采样，但不建议设置太小，对会被采样的进程造成较大的性能影响</li> <li><code>-d &lt;DURATION&gt;</code>: 指定采样持续时间，以秒为单位</li> <li><code>-f &lt;FILENAME&gt;</code>: 指定保存文件名字和格式，文件格式影响最终结果呈现形式，<code>txt</code>文档格式方便在服务器查看，<code>svg</code>矢量图格式可在浏览器打开</li> <li><code>&lt;PID&gt;</code>: 所有采样都必须指定一个JVM进程的PID， 如<code>jps</code>命令中的AlluxioFuse进程<code>8576</code></li></ul></li> <li><p>采样结果分析</p> <p>async-profiler会周期性地采样JVM调用栈，并按照被采样次数由高到低排序。
可认为采样次数越高的函数，花费的CPU时间也是越多的。因此，通过观察排名前几位的函数调用情况，可快速找出Java进程的主要性能瓶颈。</p> <p>下面是对AlluxioFuse进行cpu采样的结果，由三部分内容组成。</p> <p>第一部分，介绍采样的次数，GC情况等，其中的<code>Frame buffer usage</code>表示保存采样结果的buffer使用率。
如果采样间隔太小，或者时间太长，可能会提示<code>overflow</code>，此时可用<code>-b N</code>调大buffer容量。</p> <p>第二部分，是按照采样次数由高到低排序后的函数调用栈，性能分析时重点关注前几位。</p> <p>第三部分，在最后，是占用CPU时间由高到低的函数。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> cpu.txt
--- Execution profile ---
Total samples       <span class="token builtin class-name">:</span> <span class="token number">131152</span>
GC_active           <span class="token builtin class-name">:</span> <span class="token number">8</span> <span class="token punctuation">(</span><span class="token number">0.01</span>%<span class="token punctuation">)</span>
unknown_Java        <span class="token builtin class-name">:</span> <span class="token number">321</span> <span class="token punctuation">(</span><span class="token number">0.24</span>%<span class="token punctuation">)</span>
not_walkable_Java   <span class="token builtin class-name">:</span> <span class="token number">234</span> <span class="token punctuation">(</span><span class="token number">0.18</span>%<span class="token punctuation">)</span>
deoptimization      <span class="token builtin class-name">:</span> <span class="token number">7</span> <span class="token punctuation">(</span><span class="token number">0.01</span>%<span class="token punctuation">)</span>
skipped             <span class="token builtin class-name">:</span> <span class="token number">17</span> <span class="token punctuation">(</span><span class="token number">0.01</span>%<span class="token punctuation">)</span>

Frame buffer usage  <span class="token builtin class-name">:</span> <span class="token number">23.9887</span>%

--- <span class="token number">9902352571</span> ns <span class="token punctuation">(</span><span class="token number">7.48</span>%<span class="token punctuation">)</span>, <span class="token number">9820</span> samples
  <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span> copy_user_enhanced_fast_string_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> copyout_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> copy_page_to_iter_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> skb_copy_datagram_iter_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> tcp_recvmsg_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> inet_recvmsg_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">]</span> sock_read_iter_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">]</span> __vfs_read_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">]</span> vfs_read_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">]</span> ksys_read_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> do_syscall_64_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> entry_SYSCALL_64_after_hwframe_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token builtin class-name">read</span>
  <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> io.netty.channel.unix.FileDescriptor.readAddress
  <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> io.netty.channel.unix.FileDescriptor.readAddress
  <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> io.netty.channel.epoll.AbstractEpollChannel.doReadBytes
  <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> io.netty.channel.epoll.AbstractEpollStreamChannel<span class="token variable">$EpollStreamUnsafe</span>.epollInReady
  <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> io.netty.channel.epoll.EpollEventLoop.processReady
  <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> io.netty.channel.epoll.EpollEventLoop.run
  <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> io.netty.util.concurrent.SingleThreadEventExecutor<span class="token variable">$4</span>.run
  <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> io.netty.util.internal.ThreadExecutorMap<span class="token variable">$2</span>.run
  <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> java.lang.Thread.run

--- <span class="token number">6862595502</span> ns <span class="token punctuation">(</span><span class="token number">5.19</span>%<span class="token punctuation">)</span>, <span class="token number">6836</span> samples
  <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span> jbyte_disjoint_arraycopy
  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> io.netty.util.internal.PlatformDependent0.copyMemoryWithSafePointPolling
  <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> io.netty.util.internal.PlatformDependent0.copyMemory
  <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> io.netty.util.internal.PlatformDependent.copyMemory
  <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> io.netty.buffer.UnsafeByteBufUtil.getBytes
  <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> io.netty.buffer.PooledUnsafeDirectByteBuf.getBytes
  <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">]</span> io.netty.buffer.AbstractUnpooledSlicedByteBuf.getBytes
  <span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">]</span> io.netty.buffer.AbstractByteBuf.readBytes
  <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">]</span> io.grpc.netty.NettyReadableBuffer.readBytes
  <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">]</span> io.grpc.internal.CompositeReadableBuffer<span class="token variable">$3</span>.readInternal
  <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> io.grpc.internal.CompositeReadableBuffer<span class="token variable">$ReadOperation</span>.read
  <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> io.grpc.internal.CompositeReadableBuffer.execute
  <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> io.grpc.internal.CompositeReadableBuffer.readBytes
  <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> alluxio.grpc.ReadableDataBuffer.readBytes
  <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> alluxio.client.block.stream.BlockInStream.readInternal
  <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> alluxio.client.block.stream.BlockInStream.read
  <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> alluxio.client.file.AlluxioFileInStream.read
  <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> alluxio.client.file.cache.LocalCacheFileInStream.readExternalPage
  <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> alluxio.client.file.cache.LocalCacheFileInStream.read
  <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> alluxio.fuse.AlluxioJniFuseFileSystem.read
  <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> alluxio.jnifuse.AbstractFuseFileSystem.readCallback

--- <span class="token number">6257779616</span> ns <span class="token punctuation">(</span><span class="token number">4.73</span>%<span class="token punctuation">)</span>, <span class="token number">6234</span> samples
  <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span> jlong_disjoint_arraycopy
  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> java.util.HashMap.isEmpty
  <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> java.util.HashSet.isEmpty
  <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> alluxio.client.file.cache.store.MemoryPageStore.put
  <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> alluxio.client.file.cache.LocalCacheManager.addPage
  <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> alluxio.client.file.cache.LocalCacheManager.putInternal
  <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">]</span> alluxio.client.file.cache.LocalCacheManager.lambda<span class="token variable">$put</span><span class="token variable">$0</span>
  <span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">]</span> alluxio.client.file.cache.LocalCacheManager<span class="token variable">$$</span>Lambda<span class="token variable">$324</span>.504173880.run
  <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">]</span> java.util.concurrent.Executors<span class="token variable">$RunnableAdapter</span>.call
  <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">]</span> java.util.concurrent.FutureTask.run
  <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> java.util.concurrent.ThreadPoolExecutor.runWorker
  <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> java.util.concurrent.ThreadPoolExecutor<span class="token variable">$Worker</span>.run
  <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> java.lang.Thread.run

--- <span class="token number">5784713511</span> ns <span class="token punctuation">(</span><span class="token number">4.37</span>%<span class="token punctuation">)</span>, <span class="token number">5730</span> samples
  <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span> memcpy_erms_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> fuse_copy_do?<span class="token punctuation">[</span>fuse<span class="token punctuation">]</span>_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> fuse_copy_page?<span class="token punctuation">[</span>fuse<span class="token punctuation">]</span>_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> fuse_copy_args?<span class="token punctuation">[</span>fuse<span class="token punctuation">]</span>_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> fuse_dev_do_write?<span class="token punctuation">[</span>fuse<span class="token punctuation">]</span>_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> fuse_dev_write?<span class="token punctuation">[</span>fuse<span class="token punctuation">]</span>_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">]</span> do_iter_readv_writev_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">]</span> do_iter_write_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">]</span> vfs_writev_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">]</span> do_writev_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> do_syscall_64_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> entry_SYSCALL_64_after_hwframe_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> writev
<span class="token comment"># ...</span>
         ns  percent  samples  <span class="token function">top</span>
  ----------  -------  -------  ---
 <span class="token number">18748768943</span>   <span class="token number">14.17</span>%    <span class="token number">18618</span>  jlong_disjoint_arraycopy
 <span class="token number">12465418383</span>    <span class="token number">9.42</span>%    <span class="token number">12375</span>  copy_user_enhanced_fast_string_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
 <span class="token number">11200001765</span>    <span class="token number">8.46</span>%    <span class="token number">11153</span>  /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64/server/libjvm.so
  <span class="token number">8891711765</span>    <span class="token number">6.72</span>%     <span class="token number">8863</span>  jbyte_disjoint_arraycopy
  <span class="token number">5934957181</span>    <span class="token number">4.48</span>%     <span class="token number">5877</span>  memcpy_erms_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token number">5887736474</span>    <span class="token number">4.45</span>%     <span class="token number">5766</span>  _raw_spin_unlock_irqrestore_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token number">5722725002</span>    <span class="token number">4.32</span>%     <span class="token number">5669</span>  /lib/x86_64-linux-gnu/libc-2.23.so
  <span class="token number">5029972109</span>    <span class="token number">3.80</span>%     <span class="token number">5024</span>  jint_disjoint_arraycopy
  <span class="token number">3313144887</span>    <span class="token number">2.50</span>%     <span class="token number">3284</span>  _raw_spin_lock_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token number">2345730045</span>    <span class="token number">1.77</span>%     <span class="token number">2341</span>  jshort_disjoint_arraycopy
  <span class="token number">2111075419</span>    <span class="token number">1.60</span>%     <span class="token number">2098</span>  java.lang.Long.equals
  <span class="token number">1844566888</span>    <span class="token number">1.39</span>%     <span class="token number">1838</span>  __do_page_fault_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token number">1493059573</span>    <span class="token number">1.13</span>%     <span class="token number">1472</span>  get_user_pages_fast_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token number">1371331539</span>    <span class="token number">1.04</span>%     <span class="token number">1340</span>  finish_task_switch_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token number">1333100221</span>    <span class="token number">1.01</span>%     <span class="token number">1324</span>  clear_page_erms_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token number">1165108284</span>    <span class="token number">0.88</span>%     <span class="token number">1155</span>  io.netty.util.Recycler<span class="token variable">$WeakOrderQueue</span>.transfer
  <span class="token number">1010331386</span>    <span class="token number">0.76</span>%     <span class="token number">1004</span>  __free_pages_ok_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
   <span class="token number">806598842</span>    <span class="token number">0.61</span>%      <span class="token number">798</span>  fuse_copy_do?<span class="token punctuation">[</span>fuse<span class="token punctuation">]</span>_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
   <span class="token number">805970066</span>    <span class="token number">0.61</span>%      <span class="token number">802</span>  try_charge_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
   <span class="token number">773960647</span>    <span class="token number">0.58</span>%      <span class="token number">757</span>  <span class="token builtin class-name">read</span>
   <span class="token number">660352796</span>    <span class="token number">0.50</span>%      <span class="token number">656</span>  get_page_from_freelist_<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
</code></pre></div></li></ol> <blockquote><p><strong>Tips</strong>:</p> <ul><li>一般性能分析只需要采样<code>cpu</code>和<code>lock</code>即可，它们的结果是比较有参考意义的</li> <li>如果是和内存相关的调优，可试着采样<code>alloc</code>事件</li> <li><code>wall</code>事件采样墙上时间，<code>-t</code>选项让每个进程分开采样，它俩搭配使用效果比较好</li> <li>同一进程同时只能采样一种事件</li></ul></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/dev/runtime_dev_guide.html" class="prev">
        Dataset和Runtime的生命周期
      </a></span> <span class="next"><a href="/zh/dev/multiple-client-support.html">
        如何使用其他语言（非Go语言）客户端
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ff89ebb7.js" defer></script><script src="/assets/js/2.9883a141.js" defer></script><script src="/assets/js/61.912178b8.js" defer></script>
  </body>
</html>
